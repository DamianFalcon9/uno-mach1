<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classic UNO</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Patrick+Hand&family=Rock+Salt&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            user-select: none;
        }

        #gameContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: 
                url('background.png') no-repeat center center,
                radial-gradient(ellipse at 30% 70%, rgba(255,255,255,0.1) 0%, transparent 50%),
                linear-gradient(45deg, #4a90e2 0%, #7b68ee 50%, #ff6b6b 100%);
            background-size: cover;
        }

        .skatepark-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.3;
            background: 
                repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255,255,255,0.1) 20px, rgba(255,255,255,0.1) 21px),
                repeating-linear-gradient(-45deg, transparent, transparent 20px, rgba(0,0,0,0.1) 20px, rgba(0,0,0,0.1) 21px);
        }

        .game-board {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .player {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }

        .player.human { bottom: 20px; left: 50%; transform: translateX(-50%); }
        .player.ai1 { top: 20px; left: 20px; }
        .player.ai2 { top: 20px; right: 20px; }
        .player.ai3 { bottom: 20px; right: 20px; }

        .player-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-bottom: 8px;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .player-avatar.active {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .player-info {
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .player-name {
            font-size: 14px;
            font-weight: bold;
            font-family: 'Permanent Marker', cursive;
            margin-bottom: 4px;
            text-shadow: 
                -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000,
                -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
        }

        .card-count {
            font-size: 12px;
            font-family: 'Permanent Marker', cursive;
            background: rgba(0,0,0,0.3);
            padding: 2px 8px;
            border-radius: 12px;
            text-shadow: 
                -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000,
                -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
        }

        .ai-card-display {
            width: 60px;
            height: 90px;
            background: 
                url('BackArt.png') no-repeat center center,
                linear-gradient(135deg, #2c2c54, #40407a);
            background-size: cover;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.2);
            margin-bottom: 8px;
        }

        .card-count-glow {
            color: white;
            font-size: 16px;
            font-family: 'Permanent Marker', cursive;
            font-weight: bold;
            text-shadow: 
                2px 2px 4px rgba(0,0,0,0.8),
                0 0 10px rgba(255, 165, 0, 0.8),
                0 0 20px rgba(255, 165, 0, 0.6),
                -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000,
                -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
            margin-left: 8px;
        }

        .draw-pile-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .draw-text {
            color: white;
            font-size: 14px;
            font-family: 'Rock Salt', cursive;
            font-weight: bold;
            text-shadow: 
                2px 2px 4px rgba(0,0,0,0.8),
                -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000,
                -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
            text-align: center;
        }

        .uno-indicator {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .center-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .card {
            width: 80px;
            height: 120px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.2);
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(255,255,255,0.05) 0%, transparent 50%),
                repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(0,0,0,0.1) 2px, rgba(0,0,0,0.1) 3px);
            pointer-events: none;
        }

        .card::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            border-radius: 10px;
            background: 
                radial-gradient(ellipse at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 40%),
                radial-gradient(ellipse at 70% 70%, rgba(0,0,0,0.1) 0%, transparent 40%);
            pointer-events: none;
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }

        .card .grunge-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 10% 10%, rgba(255,255,255,0.05) 0%, transparent 30%),
                radial-gradient(ellipse at 90% 90%, rgba(0,0,0,0.1) 0%, transparent 30%),
                repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(0,0,0,0.05) 1px, rgba(0,0,0,0.05) 2px);
            pointer-events: none;
            z-index: 1;
        }

        .card.red { 
            background: 
                linear-gradient(135deg, #ED1C24, #c41820),
                repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0,0,0,0.1) 3px, rgba(0,0,0,0.1) 4px),
                radial-gradient(ellipse at 25% 25%, rgba(255,255,255,0.1) 0%, transparent 50%);
        }
        .card.purple { 
            background: 
                linear-gradient(135deg, #BA55D3, #a44bb8),
                repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0,0,0,0.1) 3px, rgba(0,0,0,0.1) 4px),
                radial-gradient(ellipse at 25% 25%, rgba(255,255,255,0.1) 0%, transparent 50%);
        }
        .card.green { 
            background: 
                linear-gradient(135deg, #A3FF1E, #8ce619),
                repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0,0,0,0.1) 3px, rgba(0,0,0,0.1) 4px),
                radial-gradient(ellipse at 25% 25%, rgba(255,255,255,0.1) 0%, transparent 50%);
        }
        .card.blue { 
            background: 
                linear-gradient(135deg, #BA55D3, #a44bb8),
                repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0,0,0,0.1) 3px, rgba(0,0,0,0.1) 4px),
                radial-gradient(ellipse at 25% 25%, rgba(255,255,255,0.1) 0%, transparent 50%);
        }
        .card.wild { 
            background: 
                linear-gradient(135deg, #000, #333),
                repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(255,255,255,0.05) 3px, rgba(255,255,255,0.05) 4px),
                radial-gradient(ellipse at 25% 25%, rgba(255,255,255,0.1) 0%, transparent 50%);
        }

        .card.wild.pyros-blast { 
            background: 
                linear-gradient(135deg, #F7B801, #e6a800),
                repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0,0,0,0.1) 3px, rgba(0,0,0,0.1) 4px),
                radial-gradient(ellipse at 25% 25%, rgba(255,255,255,0.15) 0%, transparent 50%);
        }

        .card.wild.slurphy { 
            background: 
                linear-gradient(135deg, #FFEF3C, #e6d700),
                repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0,0,0,0.1) 3px, rgba(0,0,0,0.1) 4px),
                radial-gradient(ellipse at 25% 25%, rgba(255,255,255,0.15) 0%, transparent 50%);
        }

        /* Custom PNG card backgrounds */
        .card.red-0 { background-image: url('Red-0.png'); background-size: cover; background-position: center; }
        .card.red-1 { background-image: url('Red-1.png'); background-size: cover; background-position: center; }
        .card.red-2 { background-image: url('Red-2.png'); background-size: cover; background-position: center; }
        .card.red-3 { background-image: url('Red-3.png'); background-size: cover; background-position: center; }
        .card.red-4 { background-image: url('Red-4.png'); background-size: cover; background-position: center; }
        .card.red-5 { background-image: url('Red-5.png'); background-size: cover; background-position: center; }
        .card.red-6 { background-image: url('Red-6.png'); background-size: cover; background-position: center; }
        .card.red-7 { background-image: url('Red-7.png'); background-size: cover; background-position: center; }
        .card.red-8 { background-image: url('Red-8.png'); background-size: cover; background-position: center; }
        .card.red-9 { background-image: url('Red-9.png'); background-size: cover; background-position: center; }

        .card.blue-0 { background-image: url('Blue-0.png'); background-size: cover; background-position: center; }
        .card.blue-1 { background-image: url('Blue-1.png'); background-size: cover; background-position: center; }
        .card.blue-2 { background-image: url('Blue-2.png'); background-size: cover; background-position: center; }
        .card.blue-3 { background-image: url('Blue-3.png'); background-size: cover; background-position: center; }
        .card.blue-4 { background-image: url('Blue-4.png'); background-size: cover; background-position: center; }
        .card.blue-5 { background-image: url('Blue-5.png'); background-size: cover; background-position: center; }
        .card.blue-6 { background-image: url('Blue-6.png'); background-size: cover; background-position: center; }
        .card.blue-7 { background-image: url('Blue-7.png'); background-size: cover; background-position: center; }
        .card.card.blue-8 { background-image: url('Blue-8.png'); background-size: cover; background-position: center; }
        .card.blue-9 { background-image: url('Blue-9.png'); background-size: cover; background-position: center; }

        .card.green-0 { background-image: url('Green-0.png'); background-size: cover; background-position: center; }
        .card.green-1 { background-image: url('Green-1.png'); background-size: cover; background-position: center; }
        .card.green-2 { background-image: url('Green-2.png'); background-size: cover; background-position: center; }
        .card.green-3 { background-image: url('Green-3.png'); background-size: cover; background-position: center; }
        .card.green-4 { background-image: url('Green-4.png'); background-size: cover; background-position: center; }
        .card.green-5 { background-image: url('Green-5.png'); background-size: cover; background-position: center; }
        .card.green-6 { background-image: url('Green-6.png'); background-size: cover; background-position: center; }
        .card.green-7 { background-image: url('Green-7.png'); background-size: cover; background-position: center; }
        .card.green-8 { background-image: url('Green-8.png'); background-size: cover; background-position: center; }
        .card.green-9 { background-image: url('Green-9.png'); background-size: cover; background-position: center; }

        .card.blue-0 { background-image: url('Blue-0.png'); background-size: cover; background-position: center; }
        .card.blue-1 { background-image: url('Blue-1.png'); background-size: cover; background-position: center; }
        .card.blue-2 { background-image: url('Blue-2.png'); background-size: cover; background-position: center; }
        .card.blue-3 { background-image: url('Blue-3.png'); background-size: cover; background-position: center; }
        .card.blue-4 { background-image: url('Blue-4.png'); background-size: cover; background-position: center; }
        .card.blue-5 { background-image: url('Blue-5.png'); background-size: cover; background-position: center; }
        .card.blue-6 { background-image: url('Blue-6.png'); background-size: cover; background-position: center; }
        .card.blue-7 { background-image: url('Blue-7.png'); background-size: cover; background-position: center; }
        .card.blue-8 { background-image: url('Blue-8.png'); background-size: cover; background-position: center; }
        .card.blue-9 { background-image: url('Blue-9.png'); background-size: cover; background-position: center; }

        .card.purple-0 { background-image: url('Purple-0.png'); background-size: cover; background-position: center; }
        .card.purple-1 { background-image: url('Purple-1.png'); background-size: cover; background-position: center; }
        .card.purple-2 { background-image: url('Purple-2.png'); background-size: cover; background-position: center; }
        .card.purple-3 { background-image: url('Purple-3.png'); background-size: cover; background-position: center; }
        .card.purple-4 { background-image: url('Purple-4.png'); background-size: cover; background-position: center; }
        .card.purple-5 { background-image: url('Purple-5.png'); background-size: cover; background-position: center; }
        .card.purple-6 { background-image: url('Purple-6.png'); background-size: cover; background-position: center; }
        .card.purple-7 { background-image: url('Purple-7.png'); background-size: cover; background-position: center; }
        .card.purple-8 { background-image: url('Purple-8.png'); background-size: cover; background-position: center; }
        .card.purple-9 { background-image: url('Purple-9.png'); background-size: cover; background-position: center; }

        /* Action Cards */
        .card.red-Skip { background-image: url('Red-Skip.png'); background-size: cover; background-position: center; }
        .card.red-Reverse { background-image: url('Red-Reverse.png'); background-size: cover; background-position: center; }
        .card.red-DrawTwo { background-image: url('Red-DrawTwo.png'); background-size: cover; background-position: center; }
        .card.blue-Skip { background-image: url('Blue-Skip.png'); background-size: cover; background-position: center; }
        .card.blue-Reverse { background-image: url('Blue-Reverse.png'); background-size: cover; background-position: center; }
        .card.blue-DrawTwo { background-image: url('Blue-DrawTwo.png'); background-size: cover; background-position: center; }
        .card.green-Skip { background-image: url('Green-Skip.png'); background-size: cover; background-position: center; }
        .card.green-Reverse { background-image: url('Green-Reverse.png'); background-size: cover; background-position: center; }
        .card.green-DrawTwo { background-image: url('Green-DrawTwo.png'); background-size: cover; background-position: center; }
        .card.purple-Skip { background-image: url('Purple-Skip.png'); background-size: cover; background-position: center; }
        .card.purple-Reverse { background-image: url('Purple-Reverse.png'); background-size: cover; background-position: center; }
        .card.purple-DrawTwo { background-image: url('Purple-DrawTwo.png'); background-size: cover; background-position: center; }

        /* Wild Cards */
        .card.wild.Wild { background-image: url('Wild.png'); background-size: cover; background-position: center; }
        .card.wild.WildDrawFour { background-image: url('WildDrawFour.png'); background-size: cover; background-position: center; }
        .card.wild.PyrosBlast { background-image: url('PyrosBlast.png'); background-size: cover; background-position: center; }
        .card.wild.SLURPHY { background-image: url('SLURPHY.png'); background-size: cover; background-position: center; }

        /* Disable grunge overlays for PNG cards to improve readability */
        .card.red-0::before, .card.red-0::after, .card.red-1::before, .card.red-1::after, .card.red-2::before, .card.red-2::after, .card.red-3::before, .card.red-3::after, .card.red-4::before, .card.red-4::after, .card.red-5::before, .card.red-5::after, .card.red-6::before, .card.red-6::after, .card.red-7::before, .card.red-7::after, .card.red-8::before, .card.red-8::after, .card.red-9::before, .card.red-9::after,
        .card.blue-0::before, .card.blue-0::after, .card.blue-1::before, .card.blue-1::after, .card.blue-2::before, .card.blue-2::after, .card.blue-3::before, .card.blue-3::after, .card.blue-4::before, .card.blue-4::after, .card.blue-5::before, .card.blue-5::after, .card.blue-6::before, .card.blue-6::after, .card.blue-7::before, .card.blue-7::after, .card.blue-8::before, .card.blue-8::after, .card.blue-9::before, .card.blue-9::after,
        .card.green-0::before, .card.green-0::after, .card.green-1::before, .card.green-1::after, .card.green-2::before, .card.green-2::after, .card.green-3::before, .card.green-3::after, .card.green-4::before, .card.green-4::after, .card.green-5::before, .card.green-5::after, .card.green-6::before, .card.green-6::after, .card.green-7::before, .card.green-7::after, .card.green-8::before, .card.green-8::after, .card.green-9::before, .card.green-9::after,
        .card.blue-0::before, .card.blue-0::after, .card.blue-1::before, .card.blue-1::after, .card.blue-2::before, .card.blue-2::after, .card.blue-3::before, .card.blue-3::after, .card.blue-4::before, .card.blue-4::after, .card.blue-5::before, .card.blue-5::after, .card.blue-6::before, .card.blue-6::after, .card.blue-7::before, .card.blue-7::after, .card.blue-8::before, .card.blue-8::after, .card.blue-9::before, .card.blue-9::after,
        .card.purple-0::before, .card.purple-0::after, .card.purple-1::before, .card.purple-1::after, .card.purple-2::before, .card.purple-2::after, .card.purple-3::before, .card.purple-3::after, .card.purple-4::before, .card.purple-4::after, .card.purple-5::before, .card.purple-5::after, .card.purple-6::before, .card.purple-6::after, .card.purple-7::before, .card.purple-7::after, .card.purple-8::before, .card.purple-8::after, .card.purple-9::before, .card.purple-9::after {
            display: none;
        }

        .card.red-0 .grunge-overlay, .card.red-1 .grunge-overlay, .card.red-2 .grunge-overlay, .card.red-3 .grunge-overlay, .card.red-4 .grunge-overlay, .card.red-5 .grunge-overlay, .card.red-6 .grunge-overlay, .card.red-7 .grunge-overlay, .card.red-8 .grunge-overlay, .card.red-9 .grunge-overlay,
        .card.blue-0 .grunge-overlay, .card.blue-1 .grunge-overlay, .card.blue-2 .grunge-overlay, .card.blue-3 .grunge-overlay, .card.blue-4 .grunge-overlay, .card.blue-5 .grunge-overlay, .card.blue-6 .grunge-overlay, .card.blue-7 .grunge-overlay, .card.blue-8 .grunge-overlay, .card.blue-9 .grunge-overlay,
        .card.green-0 .grunge-overlay, .card.green-1 .grunge-overlay, .card.green-2 .grunge-overlay, .card.green-3 .grunge-overlay, .card.green-4 .grunge-overlay, .card.green-5 .grunge-overlay, .card.green-6 .grunge-overlay, .card.green-7 .grunge-overlay, .card.green-8 .grunge-overlay, .card.green-9 .grunge-overlay,
        .card.blue-0 .grunge-overlay, .card.blue-1 .grunge-overlay, .card.blue-2 .grunge-overlay, .card.blue-3 .grunge-overlay, .card.blue-4 .grunge-overlay, .card.blue-5 .grunge-overlay, .card.blue-6 .grunge-overlay, .card.blue-7 .grunge-overlay, .card.blue-8 .grunge-overlay, .card.blue-9 .grunge-overlay {
            display: none;
        }

        /* Hide color-blind patterns for PNG cards */
        .card.red-0 .card-pattern, .card.red-1 .card-pattern, .card.red-2 .card-pattern, .card.red-3 .card-pattern, .card.red-4 .card-pattern, .card.red-5 .card-pattern, .card.red-6 .card-pattern, .card.red-7 .card-pattern, .card.red-8 .card-pattern, .card.red-9 .card-pattern,
        .card.blue-0 .card-pattern, .card.blue-1 .card-pattern, .card.blue-2 .card-pattern, .card.blue-3 .card-pattern, .card.blue-4 .card-pattern, .card.blue-5 .card-pattern, .card.blue-6 .card-pattern, .card.blue-7 .card-pattern, .card.blue-8 .card-pattern, .card.blue-9 .card-pattern,
        .card.green-0 .card-pattern, .card.green-1 .card-pattern, .card.green-2 .card-pattern, .card.green-3 .card-pattern, .card.green-4 .card-pattern, .card.green-5 .card-pattern, .card.green-6 .card-pattern, .card.green-7 .card-pattern, .card.green-8 .card-pattern, .card.green-9 .card-pattern,
        .card.purple-0 .card-pattern, .card.purple-1 .card-pattern, .card.purple-2 .card-pattern, .card.purple-3 .card-pattern, .card.purple-4 .card-pattern, .card.purple-5 .card-pattern, .card.purple-6 .card-pattern, .card.purple-7 .card-pattern, .card.purple-8 .card-pattern, .card.purple-9 .card-pattern {
            display: none;
        }

        /* Hide overlays for action cards and wild cards */
        .card.red-Skip::before, .card.red-Skip::after, .card.red-Reverse::before, .card.red-Reverse::after, .card.red-DrawTwo::before, .card.red-DrawTwo::after,
        .card.blue-Skip::before, .card.blue-Skip::after, .card.blue-Reverse::before, .card.blue-Reverse::after, .card.blue-DrawTwo::before, .card.blue-DrawTwo::after,
        .card.green-Skip::before, .card.green-Skip::after, .card.green-Reverse::before, .card.green-Reverse::after, .card.green-DrawTwo::before, .card.green-DrawTwo::after,
        .card.yellow-Skip::before, .card.yellow-Skip::after, .card.yellow-Reverse::before, .card.yellow-Reverse::after, .card.yellow-DrawTwo::before, .card.yellow-DrawTwo::after,
        .card.wild.Wild::before, .card.wild.Wild::after, .card.wild.WildDrawFour::before, .card.wild.WildDrawFour::after, .card.wild.PyrosBlast::before, .card.wild.PyrosBlast::after, .card.wild.SLURPHY::before, .card.wild.SLURPHY::after {
            display: none;
        }

        .card.red-Skip .grunge-overlay, .card.red-Reverse .grunge-overlay, .card.red-DrawTwo .grunge-overlay,
        .card.blue-Skip .grunge-overlay, .card.blue-Reverse .grunge-overlay, .card.blue-DrawTwo .grunge-overlay,
        .card.green-Skip .grunge-overlay, .card.green-Reverse .grunge-overlay, .card.green-DrawTwo .grunge-overlay,
        .card.yellow-Skip .grunge-overlay, .card.yellow-Reverse .grunge-overlay, .card.yellow-DrawTwo .grunge-overlay,
        .card.wild.Wild .grunge-overlay, .card.wild.WildDrawFour .grunge-overlay, .card.wild.PyrosBlast .grunge-overlay, .card.wild.SLURPHY .grunge-overlay {
            display: none;
        }

        .card.red-Skip .card-pattern, .card.red-Reverse .card-pattern, .card.red-DrawTwo .card-pattern,
        .card.blue-Skip .card-pattern, .card.blue-Reverse .card-pattern, .card.blue-DrawTwo .card-pattern,
        .card.green-Skip .card-pattern, .card.green-Reverse .card-pattern, .card.green-DrawTwo .card-pattern,
        .card.yellow-Skip .card-pattern, .card.yellow-Reverse .card-pattern, .card.yellow-DrawTwo .card-pattern,
        .card.wild.Wild .card-pattern, .card.wild.WildDrawFour .card-pattern, .card.wild.PyrosBlast .card-pattern, .card.wild.SLURPHY .card-pattern {
            display: none;
        }

        .card-back {
            background: 
                url('BackArt.png') no-repeat center center,
                linear-gradient(135deg, #2c2c54, #40407a);
            background-size: cover;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .card-rank {
            font-size: 24px;
            font-family: 'Permanent Marker', cursive;
            font-weight: bold;
            color: white;
            text-shadow: 
                2px 2px 4px rgba(0,0,0,0.8),
                1px 1px 2px rgba(0,0,0,0.9),
                0 0 8px rgba(0,0,0,0.6),
                -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000,
                -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
            position: relative;
            z-index: 2;
            text-align: center;
            line-height: 1.1;
            filter: drop-shadow(0 0 2px rgba(0,0,0,0.8));
            padding: 4px 8px;
            border-radius: 6px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(2px);
        }

        .card-rank.small {
            font-size: 16px;
            font-family: 'Permanent Marker', cursive;
            text-shadow: 
                1px 1px 3px rgba(0,0,0,0.9),
                0 0 6px rgba(0,0,0,0.7),
                -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000,
                -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
        }

        .card-rank.medium {
            font-size: 20px;
            font-family: 'Permanent Marker', cursive;
            text-shadow: 
                1px 1px 3px rgba(0,0,0,0.9),
                0 0 6px rgba(0,0,0,0.7),
                -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000,
                -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
        }

        .card-pattern {
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 12px;
            color: white;
        }

        .pattern-red::before { content: "▢"; }
        .pattern-purple::before { content: "★"; }
        .pattern-green::before { content: "●"; }
        .pattern-blue::before { content: "◆"; }

        .player-hand {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            max-width: 90vw;
            justify-content: center;
            align-items: center;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 10px 20px;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }

        .player-hand::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .player-hand .card {
            flex-shrink: 0;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .player-hand .card:hover {
            transform: translateY(-15px) scale(1.05);
            z-index: 10;
        }

        /* Responsive card sizing for different hand sizes */
        .player-hand.many-cards .card {
            min-width: 70px;
            width: 70px;
            height: 105px;
        }

        .player-hand.many-cards .card-rank {
            font-size: 20px;
        }

        .player-hand.many-cards .card-rank.small {
            font-size: 14px;
        }

        .player-hand.many-cards .card-rank.medium {
            font-size: 16px;
        }

        /* Scroll indicators for many cards */
        .player-hand.many-cards::before,
        .player-hand.many-cards::after {
            content: '';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 40px;
            background: linear-gradient(90deg, rgba(0,0,0,0.3), transparent);
            pointer-events: none;
            z-index: 5;
        }

        .player-hand.many-cards::before {
            left: 0;
            background: linear-gradient(90deg, rgba(0,0,0,0.3), transparent);
        }

        .player-hand.many-cards::after {
            right: 0;
            background: linear-gradient(270deg, rgba(0,0,0,0.3), transparent);
        }

        .hud {
            position: absolute;
            z-index: 100;
        }

        .uno-button {
            bottom: 20px;
            left: 20px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ED1C24, #c41820);
            border: none;
            color: white;
            font-size: 16px;
            font-family: 'Rock Salt', cursive;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        .uno-button:hover {
            transform: scale(1.1);
        }

        .uno-button:active {
            transform: scale(0.95);
        }

        .draw-button {
            bottom: 20px;
            left: 20px;
            padding: 12px 24px;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        .draw-button:hover {
            transform: translateY(-2px);
        }

        .pause-button {
            top: 20px;
            left: calc(50% + 80px);
            width: 40px;
            height: 40px;
            background: rgba(0,0,0,0.7);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 2px;
        }

        .pause-button:hover {
            background: rgba(0,0,0,0.9);
            transform: scale(1.05);
        }

        .pause-button .line {
            width: 16px;
            height: 2px;
            background: white;
            border-radius: 1px;
        }

        .timer {
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-family: 'Permanent Marker', cursive;
            font-weight: bold;
            text-shadow: 
                -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000,
                -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
        }

        .color-chooser {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .color-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .color-option {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.red { background: #ED1C24; }
        .color-option.blue { background: #4DE1E1; }
        .color-option.green { background: #A3FF1E; }
        .color-option.purple { background: #BA55D3; }

        .toast {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 1000;
            opacity: 0;
            animation: toast-show 2s ease-in-out;
        }

        @keyframes toast-show {
            0%, 100% { opacity: 0; transform: translate(-50%, -20px); }
            20%, 80% { opacity: 1; transform: translate(-50%, 0); }
        }

        .big-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            animation: big-popup-show 3s ease-in-out;
            pointer-events: none;
        }

        .big-popup-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 60px 80px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            transform: scale(0.5);
            animation: big-popup-scale 3s ease-in-out;
        }

        .big-popup h1 {
            color: white;
            font-size: 72px;
            margin: 0;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.5);
            font-weight: bold;
        }

        .big-popup h2 {
            color: white;
            font-size: 48px;
            margin: 20px 0 0 0;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            font-weight: bold;
        }

        .turn-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            z-index: 1000;
            opacity: 0;
            animation: turn-popup-show 2s ease-in-out;
            pointer-events: none;
        }

        .turn-popup h1 {
            color: white;
            font-size: 36px;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-weight: bold;
        }

        .turn-popup h2 {
            color: white;
            font-size: 24px;
            margin: 10px 0 0 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-weight: bold;
        }

        @keyframes turn-popup-show {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            30% { transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
        }

        .special-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: #ED1C24;
            padding: 20px 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            z-index: 1500;
            opacity: 0;
            animation: special-message-show 2.5s ease-in-out;
            pointer-events: none;
            font-size: 48px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            border: 3px solid #ED1C24;
        }

        .rekt-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: #ED1C24;
            padding: 30px 60px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.8);
            z-index: 1500;
            opacity: 0;
            animation: rekt-message-show 3s ease-in-out;
            pointer-events: none;
            font-size: 72px;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            border: 4px solid #ED1C24;
        }

        .pause-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .pause-menu-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 60px 80px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .pause-menu h1 {
            color: white;
            font-size: 48px;
            margin: 0 0 40px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .pause-menu button {
            padding: 16px 32px;
            margin: 10px;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .pause-menu button:hover {
            transform: translateY(-2px);
        }

        .pause-menu button.quit {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        @keyframes special-message-show {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.3); }
            15% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            25% { transform: translate(-50%, -50%) scale(1); }
            75% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        @keyframes rekt-message-show {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.2); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }
            30% { transform: translate(-50%, -50%) scale(1); }
            70% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.7); }
        }

        @keyframes big-popup-show {
            0% { opacity: 0; }
            20%, 80% { opacity: 1; }
            100% { opacity: 0; }
        }

        @keyframes big-popup-scale {
            0% { transform: scale(0.5); }
            20% { transform: scale(1.1); }
            30% { transform: scale(1); }
            80% { transform: scale(1); }
            100% { transform: scale(0.5); }
        }

        .menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                url('homepage.png') no-repeat center center,
                linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-size: cover;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .menu h1 {
            color: white;
            font-size: 48px;
            font-family: 'Permanent Marker', cursive;
            margin-bottom: 10px;
            text-shadow: 
                2px 2px 4px rgba(0,0,0,0.5),
                -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
        }

        .menu .subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 18px;
            font-family: 'Patrick Hand', cursive;
            margin-bottom: 40px;
            text-shadow: 
                1px 1px 2px rgba(0,0,0,0.5),
                -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
            font-style: italic;
        }

        .menu button {
            padding: 16px 32px;
            margin: 8px;
            background: linear-gradient(45deg, #42E2E7, #3BC8CD);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 18px;
            font-family: 'Rock Salt', cursive;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .menu button:hover {
            transform: translateY(-2px);
        }

        .difficulty-selector {
            margin: 20px 0;
            color: white;
            font-family: 'Rock Salt', cursive;
        }

        .difficulty-selector select {
            padding: 8px 16px;
            margin-left: 10px;
            border-radius: 4px;
            border: none;
            font-family: 'Rock Salt', cursive;
        }

        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="gameContainer">
        <!-- Skatepark Background -->
        <div class="skatepark-bg"></div>

        <!-- Main Menu -->
        <div id="mainMenu" class="menu">
            <h1>Catalyst UNO</h1>
            <h2 class="subtitle">it's a working title..</h2>
            <div class="difficulty-selector">
                <label>Difficulty:</label>
                <select id="difficultySelect">
                    <option value="easy">Easy</option>
                    <option value="medium" selected>Medium</option>
                    <option value="hard">Hard</option>
                </select>
            </div>
            <button onclick="startGame()">Play Single-Player</button>
            <button onclick="showRules()">How to Play</button>
        </div>

        <!-- Game Board -->
        <div id="gameBoard" class="game-board hidden">
            <!-- Players -->
            <div class="player human" id="player0">
                <div class="player-avatar" id="avatar0">You</div>
                <div class="player-info">
                    <div class="player-name">You</div>
                    <div class="card-count" id="count0">7</div>
                </div>
            </div>

            <div class="player ai1" id="player1">
                <div class="player-avatar" id="avatar1">S</div>
                <div class="ai-card-display" id="aiCard1"></div>
                <div class="player-info">
                    <div class="player-name">Scorch <span class="card-count-glow" id="count1">7</span></div>
                </div>
            </div>

            <div class="player ai2" id="player2">
                <div class="player-avatar" id="avatar2">P</div>
                <div class="ai-card-display" id="aiCard2"></div>
                <div class="player-info">
                    <div class="player-name">Pyro <span class="card-count-glow" id="count2">7</span></div>
                </div>
            </div>

            <div class="player ai3" id="player3">
                <div class="player-avatar" id="avatar3">R</div>
                <div class="ai-card-display" id="aiCard3"></div>
                <div class="player-info">
                    <div class="player-name">REKT Waifu <span class="card-count-glow" id="count3">7</span></div>
                </div>
            </div>

            <!-- Center Area -->
            <div class="center-area">
                <div class="draw-pile-container" onclick="drawCard()">
                    <div class="card card-back" id="drawPile"></div>
                    <div class="draw-text">DRAW</div>
                </div>
                <div class="card" id="discardPile"></div>
            </div>

            <!-- Player Hand -->
            <div class="player-hand" id="playerHand"></div>

            <!-- HUD -->
            <button class="hud uno-button" id="unoButton" onclick="callUno()">UNO!</button>
            <button class="hud pause-button" onclick="pauseGame()">
                <div class="line"></div>
                <div class="line"></div>
                <div class="line"></div>
            </button>
            <div class="hud timer" id="timer">20</div>
        </div>

        <!-- Color Chooser Modal -->
        <div id="colorChooser" class="color-chooser hidden">
            <div class="color-options">
                <button class="color-option red" onclick="chooseColor('red')"></button>
                <button class="color-option blue" onclick="chooseColor('blue')"></button>
                <button class="color-option green" onclick="chooseColor('green')"></button>
                <button class="color-option purple" onclick="chooseColor('purple')"></button>
            </div>
        </div>

        <!-- Big Popup for Turn and Winner -->
        <div id="bigPopup" class="big-popup hidden">
            <div class="big-popup-content">
                <h1 id="bigPopupTitle">YOUR TURN</h1>
                <h2 id="bigPopupSubtitle"></h2>
            </div>
        </div>

        <!-- Turn Popup (smaller, non-blocking) -->
        <div id="turnPopup" class="turn-popup hidden">
            <h1 id="turnPopupTitle">YOUR TURN!</h1>
            <h2 id="turnPopupSubtitle">Make your move!</h2>
        </div>

        <!-- Special Messages -->
        <div id="specialMessage" class="special-message hidden"></div>
        <div id="rektMessage" class="rekt-message hidden">REKT!</div>

        <!-- Pause Menu -->
        <div id="pauseMenu" class="pause-menu hidden">
            <div class="pause-menu-content">
                <h1>⏸️ GAME PAUSED</h1>
                <button onclick="resumeGame()">▶️ Resume Game</button>
                <button class="quit" onclick="quitGame()">❌ Quit Game</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            players: [],
            currentIdx: 0,
            direction: 1,
            drawPile: [],
            discardPile: [],
            currentColor: 'red',
            pendingDraw: 0,
            mustCallUnoPlayerId: null,
            phase: 'AwaitPlay',
            timerEndsAt: null,
            difficulty: 'medium'
        };

        let timerInterval = null;
        let unoTimeout = null;

        // Card definitions
        const COLORS = ['red', 'blue', 'green', 'purple']; // REKT Red, Glitch Purple, Toxic Green, Aqua Flame
        const NUMBERS = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
        const ACTIONS = ['Skip', 'Reverse', 'DrawTwo'];
        const SPECIAL_WILDS = ['PyrosBlast', 'SLURPHY'];

        // Initialize deck
        function createDeck() {
            const deck = [];
            let cardId = 0;

            // Number cards and actions for each color
            COLORS.forEach(color => {
                // 0 appears once per color
                deck.push({ id: cardId++, color, rank: '0' });
                
                // 1-9 appear twice per color
                for (let i = 1; i <= 9; i++) {
                    deck.push({ id: cardId++, color, rank: i.toString() });
                    deck.push({ id: cardId++, color, rank: i.toString() });
                }

                // Action cards appear twice per color
                ACTIONS.forEach(action => {
                    deck.push({ id: cardId++, color, rank: action });
                    deck.push({ id: cardId++, color, rank: action });
                });
            });

            // Wild cards
            for (let i = 0; i < 4; i++) {
                deck.push({ id: cardId++, color: 'wild', rank: 'Wild' });
                deck.push({ id: cardId++, color: 'wild', rank: 'WildDrawFour' });
            }

            // Special wild cards
            for (let i = 0; i < 4; i++) {
                deck.push({ id: cardId++, color: 'wild', rank: 'PyrosBlast' });
                deck.push({ id: cardId++, color: 'wild', rank: 'SLURPHY' });
            }

            return shuffle(deck);
        }

        function shuffle(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function canPlay(card, topCard, currentColor) {
            if (card.color === 'wild') return true;
            return card.color === currentColor || card.rank === topCard.rank;
        }

        function startGame() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('gameBoard').classList.remove('hidden');
            
            gameState.difficulty = document.getElementById('difficultySelect').value;
            initializeGame();
        }

        function initializeGame() {
            // Initialize players
            gameState.players = [
                { id: '0', name: 'You', isHuman: true, hand: [] },
                { id: '1', name: 'Scorch', isHuman: false, hand: [] },
                { id: '2', name: 'Pyro', isHuman: false, hand: [] },
                { id: '3', name: 'REKT Waifu', isHuman: false, hand: [] }
            ];

            // Create and shuffle deck
            gameState.drawPile = createDeck();
            gameState.discardPile = [];

            // Deal 7 cards to each player
            gameState.players.forEach(player => {
                for (let i = 0; i < 7; i++) {
                    player.hand.push(gameState.drawPile.pop());
                }
            });

            // Flip first card
            let firstCard = gameState.drawPile.pop();
            while (firstCard.rank === 'WildDrawFour') {
                gameState.drawPile.unshift(firstCard);
                gameState.drawPile = shuffle(gameState.drawPile);
                firstCard = gameState.drawPile.pop();
            }

            gameState.discardPile.push(firstCard);
            gameState.currentColor = firstCard.color === 'wild' ? 'red' : firstCard.color;

            // Apply first card effect
            applyCardEffect(firstCard, true);

            updateUI();
            startTurn();
        }

        function applyCardEffect(card, isFirstCard = false) {
            switch (card.rank) {
                case 'Skip':
                    if (!isFirstCard) {
                        advanceTurn();
                    }
                    return true;
                case 'Reverse':
                    gameState.direction *= -1;
                    if (!isFirstCard && gameState.players.length === 2) {
                        advanceTurn(); // In 2-player, reverse acts as skip
                    }
                    return true;
                case 'DrawTwo':
                    gameState.pendingDraw = 2;
                    if (!isFirstCard) {
                        showRektMessage();
                        advanceTurn();
                    }
                    return true;
                case 'WildDrawFour':
                    gameState.pendingDraw = 4;
                    if (!isFirstCard) {
                        showRektMessage();
                        advanceTurn();
                    }
                    return true;
                case 'PyrosBlast':
                    if (!isFirstCard) {
                        // Make other 3 players draw 1 card each
                        const currentPlayerIndex = gameState.currentIdx;
                        for (let i = 0; i < gameState.players.length; i++) {
                            if (i !== currentPlayerIndex) {
                                const drawnCard = drawFromPile();
                                gameState.players[i].hand.push(drawnCard);
                            }
                        }
                        showToast("Pyro's Blast! Other players draw 1 card each");
                    }
                    return true;
                case 'SLURPHY':
                    if (!isFirstCard) {
                        // Player gets another turn (don't advance turn)
                        showToast("SLURPHY! You get another turn!");
                        return false; // Don't advance turn
                    }
                    return true;
                default:
                    return true;
            }
        }

        function advanceTurn() {
            gameState.currentIdx = (gameState.currentIdx + gameState.direction + gameState.players.length) % gameState.players.length;
        }

        function startTurn() {
            const currentPlayer = gameState.players[gameState.currentIdx];
            
            // Handle pending draw
            if (gameState.pendingDraw > 0) {
                for (let i = 0; i < gameState.pendingDraw; i++) {
                    currentPlayer.hand.push(drawFromPile());
                }
                showToast(`${currentPlayer.name} draws ${gameState.pendingDraw} cards`);
                gameState.pendingDraw = 0;
                advanceTurn();
                updateUI();
                setTimeout(() => startTurn(), 1000);
                return;
            }

            updateUI();
            startTimer();

            if (currentPlayer.isHuman) {
                // Human turn - wait for input
                gameState.phase = 'AwaitPlay';
                showTurnPopup('YOUR TURN!', 'Make your move!');
            } else {
                // AI turn
                setTimeout(() => aiTurn(currentPlayer), 1000 + Math.random() * 1000);
            }
        }

        function aiTurn(player) {
            const topCard = gameState.discardPile[gameState.discardPile.length - 1];
            const playableCards = player.hand.filter(card => canPlay(card, topCard, gameState.currentColor));

            if (playableCards.length > 0) {
                const selectedCard = selectAICard(player, playableCards);
                playCard(selectedCard, player);
            } else {
                // AI draws a card
                const drawnCard = drawFromPile();
                player.hand.push(drawnCard);
                showToast(`${player.name} draws a card`);
                
                // Check if drawn card can be played
                if (canPlay(drawnCard, topCard, gameState.currentColor)) {
                    if (Math.random() > 0.3) { // 70% chance to play immediately
                        setTimeout(() => playCard(drawnCard, player), 500);
                        return;
                    }
                }
                
                setTimeout(() => endTurn(), 1000);
            }
        }

        function selectAICard(player, playableCards) {
            // Simple AI logic based on difficulty
            switch (gameState.difficulty) {
                case 'easy':
                    return playableCards[Math.floor(Math.random() * playableCards.length)];
                
                case 'medium':
                    // Prefer number cards, save action cards
                    const numberCards = playableCards.filter(card => !isNaN(card.rank));
                    if (numberCards.length > 0 && Math.random() > 0.3) {
                        return numberCards[Math.floor(Math.random() * numberCards.length)];
                    }
                    return playableCards[Math.floor(Math.random() * playableCards.length)];
                
                case 'hard':
                    // More strategic play
                    const nextPlayer = gameState.players[(gameState.currentIdx + gameState.direction + gameState.players.length) % gameState.players.length];
                    
                    // If next player has few cards, prefer action cards
                    if (nextPlayer.hand.length <= 2) {
                        const actionCards = playableCards.filter(card => ['Skip', 'DrawTwo', 'WildDrawFour'].includes(card.rank));
                        if (actionCards.length > 0) {
                            return actionCards[Math.floor(Math.random() * actionCards.length)];
                        }
                    }
                    
                    // Otherwise prefer cards that match current color
                    const colorMatches = playableCards.filter(card => card.color === gameState.currentColor);
                    if (colorMatches.length > 0) {
                        return colorMatches[Math.floor(Math.random() * colorMatches.length)];
                    }
                    
                    return playableCards[Math.floor(Math.random() * playableCards.length)];
                
                default:
                    return playableCards[0];
            }
        }

        function playCard(card, player) {
            // Remove card from player's hand
            player.hand = player.hand.filter(c => c.id !== card.id);
            
            // Add to discard pile
            gameState.discardPile.push(card);
            
            // Update current color
            if (card.color !== 'wild') {
                gameState.currentColor = card.color;
            }

            // Show special messages for action cards and special wild cards
            if (['Skip', 'Reverse', 'DrawTwo', 'WildDrawFour', 'PyrosBlast', 'SLURPHY'].includes(card.rank)) {
                showSpecialMessage(`${player.name} plays ${card.rank}!`);
            } else {
                showToast(`${player.name} plays ${card.rank}`);
            }

            // Check for UNO
            if (player.hand.length === 1) {
                if (player.isHuman) {
                    startUnoTimer();
                } else {
                    setTimeout(() => {
                        showToast(`${player.name} calls UNO!`);
                        updateUI();
                    }, 500);
                }
            }

            // Check for win
            if (player.hand.length === 0) {
                endGame(player);
                return;
            }

            // Handle wild cards
            if (['Wild', 'WildDrawFour', 'PyrosBlast', 'SLURPHY'].includes(card.rank)) {
                if (player.isHuman) {
                    showColorChooser();
                    return;
                } else {
                    // AI chooses color
                    const colors = ['red', 'blue', 'green', 'purple'];
                    gameState.currentColor = colors[Math.floor(Math.random() * colors.length)];
                    showToast(`${player.name} chooses ${gameState.currentColor}`);
                }
            }

            // Apply card effect
            applyCardEffect(card);
            
            endTurn();
        }

        function drawFromPile() {
            if (gameState.drawPile.length === 0) {
                // Reshuffle discard pile
                const topCard = gameState.discardPile.pop();
                gameState.drawPile = shuffle(gameState.discardPile);
                gameState.discardPile = [topCard];
                showToast("Deck reshuffled!");
            }
            return gameState.drawPile.pop();
        }

        function drawCard() {
            const currentPlayer = gameState.players[gameState.currentIdx];
            if (!currentPlayer.isHuman || gameState.phase !== 'AwaitPlay') return;

            const topCard = gameState.discardPile[gameState.discardPile.length - 1];
            const drawnCard = drawFromPile();
            currentPlayer.hand.push(drawnCard);

            showToast("You draw a card");
            updateUI();

            // Check if drawn card can be played
            if (canPlay(drawnCard, topCard, gameState.currentColor)) {
                // Allow player to play it or pass
                setTimeout(() => {
                    if (gameState.phase === 'AwaitPlay') {
                        endTurn();
                    }
                }, 2000);
            } else {
                setTimeout(() => endTurn(), 1000);
            }
        }

        function endTurn() {
            clearTimer();
            advanceTurn();
            updateUI();
            setTimeout(() => startTurn(), 500);
        }

        function startTimer() {
            gameState.timerEndsAt = Date.now() + 20000;
            updateTimer();
            timerInterval = setInterval(updateTimer, 100);
        }

        function clearTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function updateTimer() {
            if (!gameState.timerEndsAt) return;
            
            const remaining = Math.max(0, gameState.timerEndsAt - Date.now());
            const seconds = Math.ceil(remaining / 1000);
            
            document.getElementById('timer').textContent = seconds;
            
            if (remaining <= 0) {
                clearTimer();
                const currentPlayer = gameState.players[gameState.currentIdx];
                if (currentPlayer.isHuman) {
                    showToast("Time's up! Auto-drawing a card...");
                    // Auto-draw a card when time runs out
                    const drawnCard = drawFromPile();
                    currentPlayer.hand.push(drawnCard);
                    updateUI();
                    setTimeout(() => endTurn(), 1500);
                }
            }
        }

        function startUnoTimer() {
            gameState.mustCallUnoPlayerId = gameState.players[gameState.currentIdx].id;
            unoTimeout = setTimeout(() => {
                const player = gameState.players[gameState.currentIdx];
                if (player.isHuman && gameState.mustCallUnoPlayerId) {
                    // Penalty for not calling UNO
                    player.hand.push(drawFromPile());
                    player.hand.push(drawFromPile());
                    showToast("UNO penalty! You draw 2 cards");
                    gameState.mustCallUnoPlayerId = null;
                    updateUI();
                }
            }, 5000);
        }

        function callUno() {
            if (gameState.mustCallUnoPlayerId === '0') {
                clearTimeout(unoTimeout);
                gameState.mustCallUnoPlayerId = null;
                showToast("UNO called!");
            }
        }

        function showColorChooser() {
            document.getElementById('colorChooser').classList.remove('hidden');
        }

        function chooseColor(color) {
            gameState.currentColor = color;
            document.getElementById('colorChooser').classList.add('hidden');
            showToast(`You choose ${color}`);
            
            const currentPlayer = gameState.players[gameState.currentIdx];
            const lastCard = gameState.discardPile[gameState.discardPile.length - 1];
            
            // Apply card effects for all wild cards
            if (['WildDrawFour', 'PyrosBlast', 'SLURPHY'].includes(lastCard.rank)) {
                const shouldEndTurn = applyCardEffect(lastCard);
                
                // Only end turn if the card effect doesn't prevent it (like SLURPHY)
                if (shouldEndTurn !== false) {
                    endTurn();
                } else {
                    // For SLURPHY, start a new turn for the same player
                    updateUI();
                    setTimeout(() => startTurn(), 500);
                }
            } else {
                endTurn();
            }
        }

        function onCardClick(card) {
            const currentPlayer = gameState.players[gameState.currentIdx];
            if (!currentPlayer.isHuman || gameState.phase !== 'AwaitPlay') return;

            const topCard = gameState.discardPile[gameState.discardPile.length - 1];
            if (canPlay(card, topCard, gameState.currentColor)) {
                playCard(card, currentPlayer);
            } else {
                showToast("Can't play that card!");
            }
        }

        function updateUI() {
            // Update player info
            gameState.players.forEach((player, index) => {
                const avatar = document.getElementById(`avatar${index}`);
                
                avatar.classList.toggle('active', index === gameState.currentIdx);
                
                // Update AI card displays
                if (index > 0) { // AI players
                    const count = document.getElementById(`count${index}`);
                    count.textContent = player.hand.length;
                } else { // Human player
                    const count = document.getElementById(`count0`);
                    count.textContent = player.hand.length;
                }
                
                // Show UNO indicator
                const existingIndicator = document.querySelector(`#player${index} .uno-indicator`);
                if (player.hand.length === 1) {
                    if (!existingIndicator) {
                        const indicator = document.createElement('div');
                        indicator.className = 'uno-indicator';
                        indicator.textContent = 'UNO';
                        avatar.appendChild(indicator);
                    }
                } else if (existingIndicator) {
                    existingIndicator.remove();
                }
            });

            // Update discard pile
            const discardPile = document.getElementById('discardPile');
            if (gameState.discardPile.length > 0) {
                const topCard = gameState.discardPile[gameState.discardPile.length - 1];
                updateCardDisplay(discardPile, topCard);
            }

            // Update player hand
            const playerHand = document.getElementById('playerHand');
            const humanPlayer = gameState.players[0];
            playerHand.innerHTML = '';
            
            // Apply responsive sizing based on hand size
            if (humanPlayer.hand.length > 8) {
                playerHand.classList.add('many-cards');
            } else {
                playerHand.classList.remove('many-cards');
            }
            
            humanPlayer.hand.forEach(card => {
                const cardElement = createCardElement(card);
                cardElement.addEventListener('click', () => onCardClick(card));
                playerHand.appendChild(cardElement);
            });

            // Update draw pile count
            const drawPile = document.getElementById('drawPile');
            if (gameState.drawPile.length === 0) {
                drawPile.style.opacity = '0.5';
            } else {
                drawPile.style.opacity = '1';
            }

            // Apply responsive adjustments
            adjustForMobile();
        }

        function createCardElement(card) {
            const cardElement = document.createElement('div');
            cardElement.className = `card ${card.color}`;
            
            // Add special styling for new wild cards
            if (card.rank === 'PyrosBlast') {
                cardElement.classList.add('pyros-blast');
            } else if (card.rank === 'SLURPHY') {
                cardElement.classList.add('slurphy');
            }
            
            // Add specific classes for number cards with PNG art
            if (!isNaN(card.rank) && ['red', 'blue', 'green', 'purple'].includes(card.color)) {
                cardElement.classList.add(`${card.color}-${card.rank}`);
            }
            
            // Add specific classes for action cards with PNG art
            if (['Skip', 'Reverse', 'DrawTwo'].includes(card.rank) && ['red', 'blue', 'green', 'purple'].includes(card.color)) {
                cardElement.classList.add(`${card.color}-${card.rank}`);
            }
            
            // Add specific classes for wild cards with PNG art
            if (['Wild', 'WildDrawFour', 'PyrosBlast', 'SLURPHY'].includes(card.rank)) {
                cardElement.classList.add(card.rank);
            }
            
            // Add grunge overlay
            const grungeOverlay = document.createElement('div');
            grungeOverlay.className = 'grunge-overlay';
            cardElement.appendChild(grungeOverlay);
            
            // Add color-blind pattern
            const pattern = document.createElement('div');
            pattern.className = `card-pattern pattern-${card.color}`;
            cardElement.appendChild(pattern);
            
            // Add rank with appropriate font size
            const rank = document.createElement('div');
            rank.className = 'card-rank';
            
            // Apply font size based on card type
            if (['Wild', 'WildDrawFour', 'PyrosBlast', 'SLURPHY'].includes(card.rank)) {
                rank.classList.add('small');
            } else if (['Skip', 'Reverse', 'DrawTwo'].includes(card.rank)) {
                rank.classList.add('medium');
            }
            
            // Handle "Draw Two" as two lines
            if (card.rank === 'DrawTwo') {
                rank.innerHTML = 'Draw<br>Two';
            } else {
                rank.textContent = card.rank;
            }
            
            cardElement.appendChild(rank);
            
            return cardElement;
        }

        function updateCardDisplay(element, card) {
            element.className = `card ${card.color}`;
            element.innerHTML = '';
            
            // Add special styling for new wild cards
            if (card.rank === 'PyrosBlast') {
                element.classList.add('pyros-blast');
            } else if (card.rank === 'SLURPHY') {
                element.classList.add('slurphy');
            }
            
            // Add specific classes for number cards with PNG art
            if (!isNaN(card.rank) && ['red', 'blue', 'green', 'purple'].includes(card.color)) {
                element.classList.add(`${card.color}-${card.rank}`);
            }
            
            // Add specific classes for action cards with PNG art
            if (['Skip', 'Reverse', 'DrawTwo'].includes(card.rank) && ['red', 'blue', 'green', 'purple'].includes(card.color)) {
                element.classList.add(`${card.color}-${card.rank}`);
            }
            
            // Add specific classes for wild cards with PNG art
            if (['Wild', 'WildDrawFour', 'PyrosBlast', 'SLURPHY'].includes(card.rank)) {
                element.classList.add(card.rank);
            }
            
            // Add grunge overlay
            const grungeOverlay = document.createElement('div');
            grungeOverlay.className = 'grunge-overlay';
            element.appendChild(grungeOverlay);
            
            // Add color-blind pattern
            const pattern = document.createElement('div');
            pattern.className = `card-pattern pattern-${card.color}`;
            element.appendChild(pattern);
            
            // Add rank with appropriate font size
            const rank = document.createElement('div');
            rank.className = 'card-rank';
            
            // Apply font size based on card type
            if (['Wild', 'WildDrawFour', 'PyrosBlast', 'SLURPHY'].includes(card.rank)) {
                rank.classList.add('small');
            } else if (['Skip', 'Reverse', 'DrawTwo'].includes(card.rank)) {
                rank.classList.add('medium');
            }
            
            // Handle "Draw Two" as two lines
            if (card.rank === 'DrawTwo') {
                rank.innerHTML = 'Draw<br>Two';
            } else {
                rank.textContent = card.rank;
            }
            
            element.appendChild(rank);
        }

        function showToast(message) {
            // Remove existing toast
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            // Create new toast
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Remove after animation
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 2000);
        }

        function showBigPopup(title, subtitle = '') {
            const popup = document.getElementById('bigPopup');
            const titleElement = document.getElementById('bigPopupTitle');
            const subtitleElement = document.getElementById('bigPopupSubtitle');
            
            titleElement.textContent = title;
            subtitleElement.textContent = subtitle;
            
            popup.classList.remove('hidden');
            
            // Remove popup after animation completes
            setTimeout(() => {
                popup.classList.add('hidden');
            }, 3000);
        }

        function showTurnPopup(title = 'YOUR TURN!', subtitle = 'Make your move!') {
            const popup = document.getElementById('turnPopup');
            const titleElement = document.getElementById('turnPopupTitle');
            const subtitleElement = document.getElementById('turnPopupSubtitle');
            
            titleElement.textContent = title;
            subtitleElement.textContent = subtitle;
            
            popup.classList.remove('hidden');
            
            // Remove popup after animation completes
            setTimeout(() => {
                popup.classList.add('hidden');
            }, 2000);
        }

        function showSpecialMessage(message) {
            const specialMsg = document.getElementById('specialMessage');
            specialMsg.textContent = message;
            specialMsg.classList.remove('hidden');
            
            setTimeout(() => {
                specialMsg.classList.add('hidden');
            }, 2500);
        }

        function showRektMessage() {
            const rektMsg = document.getElementById('rektMessage');
            rektMsg.classList.remove('hidden');
            
            setTimeout(() => {
                rektMsg.classList.add('hidden');
            }, 3000);
        }

        function endGame(winner) {
            clearTimer();
            clearTimeout(unoTimeout);
            
            showToast(`${winner.name} wins!`);
            showBigPopup(`${winner.name.toUpperCase()} WINS!`, '🎉 Congratulations! 🎉');
            
            setTimeout(() => {
                if (confirm(`${winner.name} wins! Play again?`)) {
                    initializeGame();
                } else {
                    endCurrentGame();
                }
            }, 3000);
        }

        function showSettings() {
            alert('Settings menu coming soon!\n\nCurrent features:\n- Difficulty selection\n- Turn timer: 20 seconds\n- Official UNO rules\n- Color-blind support');
        }

        function endCurrentGame() {
            clearTimer();
            clearTimeout(unoTimeout);
            
            // Reset game state
            gameState = {
                players: [],
                currentIdx: 0,
                direction: 1,
                drawPile: [],
                discardPile: [],
                currentColor: 'red',
                pendingDraw: 0,
                mustCallUnoPlayerId: null,
                phase: 'AwaitPlay',
                timerEndsAt: null,
                difficulty: 'medium'
            };
            
            // Hide all popups and menus
            document.getElementById('pauseMenu').classList.add('hidden');
            document.getElementById('bigPopup').classList.add('hidden');
            document.getElementById('turnPopup').classList.add('hidden');
            document.getElementById('specialMessage').classList.add('hidden');
            document.getElementById('rektMessage').classList.add('hidden');
            document.getElementById('colorChooser').classList.add('hidden');
            
            // Hide game board and show main menu
            document.getElementById('gameBoard').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
        }

        function pauseGame() {
            clearTimer();
            clearTimeout(unoTimeout);
            document.getElementById('pauseMenu').classList.remove('hidden');
        }

        function resumeGame() {
            document.getElementById('pauseMenu').classList.add('hidden');
            // Resume the game
            if (gameState.players[gameState.currentIdx].isHuman) {
                startTimer();
            }
        }

        function quitGame() {
            endCurrentGame();
        }

        function showRules() {
            alert(`🎮 How to Play UNO

🎯 Objective: Be the first to play all your cards!

📋 Rules:
• Match the color or number/symbol of the top card
• Wild cards can be played anytime
• Draw a card if you can't play
• Call "UNO" when you have 1 card left (within 5 seconds)

🎴 Special Cards:
• Skip: Next player loses their turn
• Reverse: Change direction of play
• Draw Two: Next player draws 2 cards and skips
• Wild: Choose any color
• Wild Draw Four: Choose color, next player draws 4

🔥 Special Wild Cards:
• Pyro's Blast: Choose any color, all other players draw 1 card
• SLURPHY: Choose any color, then take another turn

⚡ Action Cards:
• Click cards to play them
• Use DRAW button to draw cards
• Press UNO button when you have 1 card
• Press PAUSE button to return to menu

🎲 AI Difficulty:
• Easy: Random plays
• Medium: Basic strategy
• Hard: Advanced tactics`);
        }

        // Initialize the game when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Set focus on difficulty selector
            document.getElementById('difficultySelect').focus();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'u' || e.key === 'U') {
                callUno();
            } else if (e.key === 'd' || e.key === 'D') {
                drawCard();
            } else if (e.key === 'p' || e.key === 'P') {
                pauseGame();
            } else if (e.key === 'Escape') {
                const colorChooser = document.getElementById('colorChooser');
                if (!colorChooser.classList.contains('hidden')) {
                    // Auto-choose red if escape is pressed
                    chooseColor('red');
                } else {
                    // Pause game if escape is pressed outside color chooser
                    pauseGame();
                }
            }
        });

        // Handle color chooser with number keys
        document.addEventListener('keydown', function(e) {
            const colorChooser = document.getElementById('colorChooser');
            if (!colorChooser.classList.contains('hidden')) {
                switch(e.key) {
                    case '1': chooseColor('red'); break;
                    case '2': chooseColor('blue'); break;
                    case '3': chooseColor('green'); break;
                    case '4': chooseColor('purple'); break;
                }
            }
        });

        // Touch and mobile support
        let touchStartY = 0;
        let touchStartX = 0;
        let touchStartScrollX = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartY = e.touches[0].clientY;
            touchStartX = e.touches[0].clientX;
            
            // Store initial scroll position for horizontal scrolling
            const playerHand = document.getElementById('playerHand');
            if (playerHand) {
                touchStartScrollX = playerHand.scrollLeft;
            }
        });

        document.addEventListener('touchmove', function(e) {
            const playerHand = document.getElementById('playerHand');
            if (playerHand && playerHand.classList.contains('many-cards')) {
                // Allow horizontal scrolling for the player hand
                const diffX = touchStartX - e.touches[0].clientX;
                playerHand.scrollLeft = touchStartScrollX + diffX;
                e.preventDefault(); // Prevent default scrolling
            }
        });

        document.addEventListener('touchend', function(e) {
            if (!touchStartY || !touchStartX) return;
            
            const touchEndY = e.changedTouches[0].clientY;
            const touchEndX = e.changedTouches[0].clientX;
            const diffY = touchStartY - touchEndY;
            const diffX = touchStartX - touchEndX;
            
            // Detect swipe gestures for card selection
            if (Math.abs(diffY) > Math.abs(diffX) && Math.abs(diffY) > 50) {
                if (diffY > 0) {
                    // Swipe up - try to play first playable card
                    const currentPlayer = gameState.players[gameState.currentIdx];
                    if (currentPlayer.isHuman && gameState.phase === 'AwaitPlay') {
                        const topCard = gameState.discardPile[gameState.discardPile.length - 1];
                        const playableCard = currentPlayer.hand.find(card => canPlay(card, topCard, gameState.currentColor));
                        if (playableCard) {
                            onCardClick(playableCard);
                        }
                    }
                }
            }
            
            touchStartY = 0;
            touchStartX = 0;
            touchStartScrollX = 0;
        });

        // Responsive design adjustments
        function adjustForMobile() {
            if (window.innerWidth < 768) {
                document.documentElement.style.setProperty('--card-width', '60px');
                document.documentElement.style.setProperty('--card-height', '90px');
                document.documentElement.style.setProperty('--avatar-size', '50px');
                
                // Adjust card sizes for mobile
                const cards = document.querySelectorAll('.card');
                cards.forEach(card => {
                    card.style.width = '60px';
                    card.style.height = '90px';
                });
                
                // Adjust font sizes for mobile
                const cardRanks = document.querySelectorAll('.card-rank');
                cardRanks.forEach(rank => {
                    if (rank.classList.contains('small')) {
                        rank.style.fontSize = '12px';
                    } else if (rank.classList.contains('medium')) {
                        rank.style.fontSize = '14px';
                    } else {
                        rank.style.fontSize = '18px';
                    }
                });
            } else {
                document.documentElement.style.setProperty('--card-width', '80px');
                document.documentElement.style.setProperty('--card-height', '120px');
                document.documentElement.style.setProperty('--avatar-size', '60px');
                
                // Reset card sizes for desktop
                const cards = document.querySelectorAll('.card');
                cards.forEach(card => {
                    card.style.width = '80px';
                    card.style.height = '120px';
                });
                
                // Reset font sizes for desktop
                const cardRanks = document.querySelectorAll('.card-rank');
                cardRanks.forEach(rank => {
                    if (rank.classList.contains('small')) {
                        rank.style.fontSize = '16px';
                    } else if (rank.classList.contains('medium')) {
                        rank.style.fontSize = '20px';
                    } else {
                        rank.style.fontSize = '24px';
                    }
                });
            }
        }

        window.addEventListener('resize', adjustForMobile);
        window.addEventListener('orientationchange', adjustForMobile);

        // Performance optimization - throttle UI updates
        let updateUIThrottled = false;
        const originalUpdateUI = updateUI;
        updateUI = function() {
            if (updateUIThrottled) return;
            updateUIThrottled = true;
            originalUpdateUI();
            requestAnimationFrame(() => {
                updateUIThrottled = false;
            });
        };

        // Add visual feedback for valid card plays
        function highlightPlayableCards() {
            if (gameState.players[gameState.currentIdx].isHuman && gameState.phase === 'AwaitPlay') {
                const topCard = gameState.discardPile[gameState.discardPile.length - 1];
                const humanPlayer = gameState.players[0];
                
                document.querySelectorAll('.player-hand .card').forEach((cardElement, index) => {
                    const card = humanPlayer.hand[index];
                    if (card && canPlay(card, topCard, gameState.currentColor)) {
                        cardElement.style.boxShadow = '0 0 15px rgba(0, 255, 0, 1), 0 0 25px rgba(0, 255, 0, 0.6)';
                    } else {
                        cardElement.style.boxShadow = '0 4px 8px rgba(0,0,0,0.3)';
                    }
                });
            }
        }

        // Update the updateUI function to include card highlighting
        const originalUpdateUIWithHighlight = updateUI;
        updateUI = function() {
            originalUpdateUIWithHighlight();
            setTimeout(highlightPlayableCards, 100);
        };
    </script>
</body>
</html>
</html>